&ACCESS RVO
&PARAM EDITMASK = *
&PARAM TEMPLATE = C:\KRC\Roboter\Template\vorgabe
DEFDAT _1_MAIN_gcodeToMotion PUBLIC
; 77777
; EXT  BAS (BAS_COMMAND  :IN,REAL  :IN )
; DECL INT SUCCESS

; EXT BOOL fronius_gas_on(BOOL :IN)
; EXT BOOL fronius_weld_on(BOOL :IN)
GLOBAL CONST INT INITIAL_TOOL = 1
GLOBAL CONST INT INITIAL_BASE = 5

GLOBAL CONST REAL SPEED_LIMIT_ORI = 4.2 ;; very slow orientation adjust speed anti crash.

GLOBAL CHAR g_MAIN__gcode_raw_buffer[48]
GLOBAL CHAR g_MAIN__feedback_buffer[48]

DECL E6POS last_rendered_position

GLOBAL CONST REAL MAXIMUM_CP_SPEED_LIMIT = 0.1 ; in meter/s .. i.e. 0.1 is 100mm/s
GLOBAL CONST REAL Z_SOFT_LIMIT = 0.0

; Whitelisted TOOL options  
GLOBAL BOOL ALLOWED_TOOLS[16]
; Whitelisted BASE options
GLOBAL BOOL ALLOWED_BASES[32]


; Command type constants
GLOBAL CONST INT CMD_MOTION = 0  ; Default G1 motion
GLOBAL CONST INT CMD_TOOL_1 = 1  ; T1
GLOBAL CONST INT CMD_TOOL_2 = 2  ; T2
GLOBAL CONST INT CMD_TOOL_3 = 3  ; T3
GLOBAL CONST INT CMD_TOOL_4 = 4  ; T4
GLOBAL CONST INT CMD_TOOL_5 = 5  ; T5
GLOBAL CONST INT CMD_TOOL_6 = 6  ; T6
GLOBAL CONST INT CMD_TOOL_7 = 7  ; T7
GLOBAL CONST INT CMD_TOOL_8 = 8  ; T8
GLOBAL CONST INT CMD_TOOL_9 = 9  ; T9
GLOBAL CONST INT CMD_WCS_1 = 54 ; G54
GLOBAL CONST INT CMD_WCS_2 = 55 ; G55
GLOBAL CONST INT CMD_WCS_3 = 56 ; G56
GLOBAL CONST INT CMD_WCS_4 = 57 ; G57
GLOBAL CONST INT CMD_WCS_5 = 58 ; G58
GLOBAL CONST INT CMD_WCS_6 = 59 ; G59
GLOBAL CONST INT CMD_ROBOT_HOME_G28=28 ; G28
GLOBAL CONST INT CMD_WORKSPACE_HOME_G30=30 ; G30

; Bitmask constants for command fields
GLOBAL CONST INT BITMASK_X = 'B00000001'    ; 2^0 = 1
GLOBAL CONST INT BITMASK_Y = 'B00000010'    ; 2^1 = 2
GLOBAL CONST INT BITMASK_Z = 'B00000100'    ; 2^2 = 4
GLOBAL CONST INT BITMASK_A = 'B00001000'    ; 2^3 = 8
GLOBAL CONST INT BITMASK_B = 'B00010000'   ; 2^4 = 16
GLOBAL CONST INT BITMASK_C = 'B00100000'   ; 2^5 = 32
GLOBAL CONST INT BITMASK_F = 'B01000000'   ; 2^6 = 64
GLOBAL CONST INT BITMASK_E = 'B10000000'  ; 2^7 = 128

GLOBAL INT g_seq=-1
GLOBAL INT g_queue_size=0
;() 1
GLOBAL STRUC GCODE_CMD_T INT seq,INT cmd_type,REAL X,REAL Y,REAL Z,REAL A,REAL B,REAL C,REAL F,REAL E,INT Bitmask


; the sequence number that is currently in motion
GLOBAL INT seq_in_flight=18

; the last sequence number that got rendered
GLOBAL INT seq_rendered=18

EXT  BAS (BAS_COMMAND  :IN,REAL  :IN )
DECL INT SUCCESS

DECL INT CMT_droplets_prev=5

DECL CONST INT GAS_POSTFLOW_SEC=5
DECL CONST INT GAS_PREFLOW_SEC=5

DECL BOOL WELDING=TRUE

; the flag which turns on or off the actual welding
DECL INT WELD_FLAG_IDX=32


GLOBAL STRUC g_POS_ACT_T REAL X,REAL Y,REAL Z,REAL A,REAL B,REAL C
DECL GLOBAL g_POS_ACT_T g_POS_ACT={X 0.0,Y 0.0,Z 0.0,A 0.0,B 0.0,C 0.0}

GLOBAL CONST E6POS T5_B2_HOME = {X 0.0, Y 0.0, Z 500.0, A -90.0, B 0.0, C 0.0}


ENDDAT
